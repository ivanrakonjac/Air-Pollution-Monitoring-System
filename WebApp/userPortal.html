<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>

	<title>MAPS & DATA</title>

	<script src="https://www.gstatic.com/firebasejs/3.1.0/firebase.js"></script>

	<style>
		#map{
			height: 600px;
			width: 100%;
		}
	</style>

</head>
<body>
	<h1>MY GOOGLE MAP</h1>
	<div id="map"></div>
	<script>

		// Your web app's Firebase configuration
		  var firebaseConfig = {
		  	apiKey: "",
		    authDomain: "",
		    databaseURL: "",
		    projectId: "",
		    storageBucket: "",
		    messagingSenderId: "",
		    appId: "",
		    measurementId: ""
		    
		  };

				  // Initialize Firebase
		  firebase.initializeApp(firebaseConfig);

		  var database = firebase.database();
		  var ref = database.ref('merenja');
		  var keys;
		  var merenja;

		  ref.on("value", function(snapshot) {
			    //console.log(snapshot.val());
			    merenja = snapshot.val();
			    keys = Object.keys(merenja);
			 	
			 	initMap();
			    
		   	}, function (error) {
			   console.log("Error: " + error.code);
			});

		function initMap() {

			//Map options
			var options = {
				zoom:14,
				center:{lat:44.80401, lng:20.46513}
			};

			//New map
			var map = new google.maps.Map(document.getElementById("map"), options);

			for (var i = 0; i < keys.length; i++) {
			   	var k = keys[i];
			   	var id = merenja[k].id;
			   	var lat = merenja[k].lat;
			   	var lng = merenja[k].lng;
			   	var vrednost = merenja[k].vrednost;

			   	console.log(id + " " + lat + " " + lng + " " + vrednost);

				addMarker({
					id: id,
					coords:{lat:lat, lng:lng},
					data: "Poslednje izmerena vrednost PM-10 je: " + vrednost[0] +" Î¼g/m3",
					vrednost: vrednost[0]
				});

			   	for (var j = 0; j < vrednost.length; j++) {
			   		console.log(vrednost[j]);
			   	}
			 }  	
			

			//Add marker function
			function addMarker(props) {
				var color;
				console.log("Podaci " + props.data);
				if(props.vrednost<10){
					color='green';
					console.log("<10");
				}else{
					color='red';
					console.log(">10");

				}
				var marker = new google.maps.Marker({
					id: props.id,
					icon: {
				        path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW,
				        strokeColor: color,
				        scale: 5
				    },
					position: props.coords,
					map: map	
				});

				if(props.data){
					var infoWindow = new google.maps.InfoWindow({
						content: props.data 
					});

					marker.addListener('click',function(){
						infoWindow.open(map,marker);
					});
				}
			}

		}
	</script>
	<script async defer
 	 	src="https://maps.googleapis.com/maps/api/js?key=&callback=initMap">
	</script>

</body>
</html>

